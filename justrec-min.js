var justrec={settings:{},init:function(options,element){if(element){if(element.jquery){element=element[0];}else if(typeof element=='string'){if(/^#.*/.test(element))
element=element.slice(1);element=document.getElementById(element);}}
if(!element||element.nodeType!=1)
element=document.getElementsByTagName('body')[0];this.settings={'rec_width':480,'rec_height':320,'recorderlayout_id':'justrec_area','recorder_id':'justrec','recorder_name':'justrec','swf_path':'justrec.swf','host':'micupload.php?f=justrec.mp3','recordingStarted':function(){},'recordingStopped':function(){},'recordingError':function(){},'recordingActivity':function(time,level){},'sendingFinished':function(){},'sendingProgress':function(percent){},'mp3Converting':function(percent){},'mp3Converted':function(){},'mp3ConvertingError':function(){}};for(var prop in options)
this.settings[prop]=options[prop];var createParam=function(el,n,v){var p=document.createElement("param");p.setAttribute("name",n);p.setAttribute("value",v);el.appendChild(p);};htmlObj=document.createElement("object");htmlObj.setAttribute("id",this.settings['recorder_id']);htmlObj.setAttribute("name",this.settings['recorder_name']);htmlObj.setAttribute("data",this.settings['swf_path']+'?host='+this.settings['host']);htmlObj.setAttribute("type","application/x-shockwave-flash");htmlObj.setAttribute("width",this.settings['rec_width']);htmlObj.setAttribute("height",this.settings['rec_height']);createParam(htmlObj,"allowscriptaccess",'always');createParam(htmlObj,"bgcolor",'#FFF');createParam(htmlObj,"wmode",'transparent');var divObj=document.createElement("div");divObj.setAttribute("id",this.settings['recorderlayout_id']);divObj.setAttribute("style",'position:absolute; top:0; left:0; z-index:-1');divObj.appendChild(htmlObj);var elPosType=element.style.position.toUpperCase(),elStatic=(elPosType==''||elPosType=='STATIC');if(element.nodeName.toUpperCase()!='BODY'&&elStatic)
element.style.position='relative';element.appendChild(divObj);},getFlashMovie:function(movieName){return window.document[movieName];},record:function(maxTime){document.getElementById(this.settings['recorderlayout_id']).style.zIndex=100000;this.getFlashMovie(this.settings['recorder_name']).jStartRecording(maxTime);},stop:function(){this.getFlashMovie(this.settings['recorder_name']).jStopRecording();},preview:function(){this.getFlashMovie(this.settings['recorder_name']).jPreview();},stoppreview:function(){this.getFlashMovie(this.settings['recorder_name']).jStopPreview();},convert:function(){this.getFlashMovie(this.settings['recorder_name']).jConvert2MP3();},send:function(){this.getFlashMovie(this.settings['recorder_name']).jSendFileToServer();},recordingStarted:function(){this.settings['recordingStarted']();},recordingStopped:function(){this.settings['recordingStopped']();},recordingError:function(){this.settings['recordingError']();},sendingProgress:function(percent){this.settings['sendingProgress'](percent);},sendingFinished:function(){this.settings['sendingFinished']();},recordingActivity:function(time,level){document.getElementById(this.settings['recorderlayout_id']).style.zIndex=-1;this.settings['recordingActivity'](time,level);},mp3Converting:function(percent){this.settings['mp3Converting'](percent);},mp3Converted:function(){this.settings['mp3Converted']();},mp3ConvertingError:function(){this.settings['mp3ConvertingError']();}}